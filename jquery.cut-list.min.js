(function(f,_,m){const i={moreBtnTitle:"Еще",showMoreOnHover:false,alwaysVisibleElem:undefined,onBeforeCalc:function(){},onBeforeOpen:function(){},onOpen:function(){},onBeforeClose:function(){},onClose:function(){},resizeDelay:50,minWidth:null};const t=300;class s{constructor(t,e){this.elements=f(t);this.options=f.extend({},i,e);this.resizeTimeoutObserver=null;this.resizeTimeoutWindow=null;this.observers=[];this.setupObserversInited=false;this.initialized=false;this.destroyed=false;if(this.options.minWidth&&this.options.minWidth>0){this.checkScreenWidth();this.setupWindowResizeHandler()}else{this.init()}}checkScreenWidth(){const t=f(_).width();const e=this.options.minWidth&&this.options.minWidth>0?t<=this.options.minWidth:false;if(e&&this.initialized){this.destroy()}if(e){return}if(!e&&!this.initialized){this.init()}else if(!e){this.redrawList()}}updateDocumentClickHandler(){f(m).off("click.cutList");f(m).on("click.cutList",this.documentClickHandler.bind(this))}documentClickHandler(t){if(!f(t.target).closest(".cut-list__dropdown").length){this.options.onBeforeClose(this.elements);f(".cut-list__dropdown.is-show").removeClass("is-show").find(".cut-list__more").hide().removeClass("is-top is-left");this.options.onClose(this.elements)}}init(){if(this.initialized){this.destroy()}this.elements.each((t,e)=>{const i=f(e);i.addClass("cut-list-ready");this.setup(i)});this.initialized=true;this.destroyed=false;this.updateDocumentClickHandler();this.setupObservers()}setup(t){if(!t.find(".cut-list__dropdown").length){this.createDropdownElements(t)}t.addClass("cut-list").children().not(".cut-list__dropdown").each(function(t){f(this).attr("data-index",t).addClass("cut-list__elem")});let e=t.find(".cut-list__elem").length;let i=t.find(this.options.alwaysVisibleElem+":first").index();if(t.find(this.options.alwaysVisibleElem).length>1){console.warn("Внимание! Вами назначено несколько alwaysVisibleElem, будет использоваться только первый.")}this.create(t,i,e);this.setEventHandlers(t)}createDropdownElements(t){t.append('<div style="display:none" class="cut-list__elem cut-list__dropdown"></div>').find(".cut-list__dropdown").append('<div class="cut-list__drop"></div>').find(".cut-list__drop").append(`<div class="cut-list__drop-toggle">${this.options.moreBtnTitle}</div>`).append('<div class="cut-list__more"><div class="cut-list__more-content"></div></div>')}setEventHandlers(t){const e=this.options;if(e.showMoreOnHover){this.addHoverHandlers(t)}else{this.addClickHandlers(t)}}addHoverHandlers(t){t.find(".cut-list__drop").off("mouseenter mouseleave").hover(()=>{t.find(".cut-list__dropdown").addClass("is-show");this.showMore(t.find(".cut-list__dropdown .cut-list__more"),t)},()=>{this.options.onBeforeClose(t);t.find(".cut-list__dropdown").removeClass("is-show");this.hideMore(t.find(".cut-list__dropdown").find(".cut-list__more"));this.options.onClose(t)})}addClickHandlers(i){i.find(".cut-list__drop-toggle").off("click.cutList").on("click.cutList",()=>{const t=i.find(".cut-list__dropdown");const e=t.toggleClass("is-show").hasClass("is-show");if(e){this.showMore(t.find(".cut-list__more"),i)}else{this.hideMore(t.find(".cut-list__more"))}})}setupObservers(){this.removeObservers();this.elements.each((t,e)=>{const i=new ResizeObserver(()=>{if(this.setupObserversInited){clearTimeout(this.resizeTimeoutObserver);this.resizeTimeoutObserver=setTimeout(()=>{if(!this.destroyed){this.redrawList()}},this.options.resizeDelay)}this.setupObserversInited=true});i.observe(e);this.observers.push(i)})}setupWindowResizeHandler(){f(_).on("resize.cutList",this.debouncedHandleResize.bind(this))}debouncedHandleResize(){clearTimeout(this.resizeTimeoutWindow);this.resizeTimeoutWindow=setTimeout(()=>{this.checkScreenWidth()},t)}removeObservers(){this.observers.forEach(t=>t.disconnect());this.observers=[]}redrawList(){if(this.initialized){this.elements.each((t,e)=>{const i=f(e);const s=i.find(".cut-list__dropdown");const n=s.find(".cut-list__more-content");n.children(".cut-list__elem").each(function(){f(this).detach().insertBefore(s)});s.remove();i.children().removeClass("cut-list__elem").removeAttr("data-index");this.setup(i)})}}destroy(){this.removeObservers();f(m).off("click.cutList");this.elements.each((t,e)=>{const i=f(e);const s=i.find(".cut-list__dropdown");const n=s.find(".cut-list__more-content");n.children(".cut-list__elem").each(function(){f(this).detach().insertBefore(s)});s.remove();i.children().removeClass("cut-list__elem").removeAttr("data-index")});this.initialized=false;this.destroyed=true}create(t,e,i){const s=t.innerWidth();let n=t.find(".cut-list__dropdown").outerWidth(true);const o=this.getFindElemsSelector(e);if(e!=-1){n+=this.getOuterWidthWithMargin(t.find(this.options.alwaysVisibleElem+":first"))}const l=t.find(o);const d=this.shouldShowMoreItems(l,n,s,e);if(d){this.move(t,this.position,i);t.addClass("with-more-items").find(".cut-list__dropdown").show()}else{t.find(".cut-list__more-content .cut-list__elem").insertBefore(t.find(".cut-list__dropdown"));t.removeClass("with-more-items").find(".cut-list__dropdown").hide()}}getFindElemsSelector(t){return t===-1?'.cut-list__elem:not(".cut-list__dropdown")':`.cut-list__elem:not(".cut-list__dropdown, ${this.options.alwaysVisibleElem}:first")`}shouldShowMoreItems(e,t,i,s){let n=t;for(let t=0;t<e.length;t++){const o=f(e[t]);n+=this.getOuterWidthWithMargin(o);if(n>=i){this.position=s!==-1&&t>s?t+1:t;return true}}return false}getOuterWidthWithMargin(t){const e=parseInt(t.css("margin-left"),10)||0;const i=parseInt(t.css("margin-right"),10)||0;return t.outerWidth()+e+i}move(e,i,s){const n=this.getFindElemsSelector(this.alwaysVisibleIndex);for(let t=i;t<=s;t++){e.find(`${n}[data-index="${t}"]`).appendTo(e.find(".cut-list__more-content"))}if(this.alwaysVisibleIndex!=-1){this.handleRemainingAlwaysVisibleElement(e)}}handleRemainingAlwaysVisibleElement(e){const i=e.width();const s=e.find(".cut-list__elem:first");const t=s.is(this.options.alwaysVisibleElem);if(t){let t=e.find(".cut-list__dropdown").outerWidth(true)+this.getOuterWidthWithMargin(s);if(t>=i){const n=s.data("index");e.find(`.cut-list__elem:not(".cut-list__dropdown")[data-index="${n}"]`).appendTo(e.find(".cut-list__more-content"))}}}hideMore(t){f(t).hide().removeClass("is-top is-left")}showMore(t,e){const i=f(_).height();const s=f(m).height();const n=f(_).scrollTop();const o=t.outerHeight();const l=e.offset().top+e.outerHeight();t.css("visibility","hidden").show();this.options.onBeforeCalc(e);const d=s-l;const r=e.offset().top-n;const c=i-(l-n);const h=d>=o;const a=r>=o;const u=c>=o;t.toggleClass("is-top",!u&&a||!h&&a);t.toggleClass("is-left",t.offset().left<0);this.options.onBeforeOpen(e);t.css("visibility","visible");this.options.onOpen(e)}}f.fn.cutList=function(t){return this.each(function(){if(!f.data(this,"InsalesCutList")){f.data(this,"InsalesCutList",new s(this,t))}})};f.fn.cutList.setup=function(t,e={}){return f(t).each(function(){const t=f.data(this,"InsalesCutList");if(t){t.init()}else{f.data(this,"InsalesCutList",new s(this,e))}})};f.fn.cutList.destroy=function(t){return f(t).each(function(){const t=f.data(this,"InsalesCutList");if(t){t.destroy()}})};_.InsalesCutList=s})(jQuery,window,document);